<div class="container">

  <step-wizard steps="wizardSteps" save-trigger="saveAndExit()" prev-trigger="goToPreviousStep()"
               save-button-text="saveButtonName"></step-wizard>

  <form-error-dialog></form-error-dialog>

  <form name="storeInstancePackingForm" ng-submit="goToNextStep()">

    <!-- INFORMATION BAR -->
    <store-instance-header></store-instance-header>

    <div class="well">
      <div class="form-group">
        <p class="input-group">
          <span class="input-group-btn">
          <button type="button" class="btn btn-default" ng-disabled="true">
            <i class="fa fa-filter"></i> Filter By
          </button>
          </span>
          <input ng-model="filterItemDetails" type="text" class="form-control" id="filter-item-details"
                 placeholder="Type an item code or name"/>
        </p>
      </div>
    </div>

    <div class="well">
      <h3>
        <span ng-hide="isActionState('end-instance')">Pick List</span>
        <span ng-show="isActionState('end-instance')">Offload List</span>
      </h3>

      <table class="table pick-list">
        <thead>
        <tr>
          <th>Retail Item Details</th>
          <th ng-show="shouldDisplayQuantityField('inbound')" width="10%">Inbound Quantity</th>
          <th ng-show="shouldDisplayQuantityField('ullage')" width="10%">Ullage Quantity</th>
          <th ng-show="shouldDisplayQuantityField('ullage')" width="15%">Ullage Reason</th>
          <th ng-show="shouldDisplayQuantityField('template')" width="10%">Template Quantity</th>
          <th ng-show="shouldDisplayQuantityField('packed')" width="10%">Picked Quantity</th>
          <th ng-show="shouldDisplayQuantityField('dispatch')" width="10%">Dispatched Quantity</th>
          <th width="5%"></th>
        </tr>
        </thead>

        <tbody>
        <!--<tr ng-repeat="item in menuItems | filter:{itemDescription: filterItemDetails} | orderBy:'itemName'"-->
            <!--ng-class="setClassBasedOnVariance(item.menuQuantity, item.quantity)">-->
        <tr ng-repeat="item in menuItems | filter:{itemDescription: filterItemDetails} | orderBy:'itemName'">
          <td>
            <input type="text" class="form-control" ng-model="item.itemDescription"
                   disabled/>
          </td>
          <td ng-if="shouldDisplayQuantityField('inbound')">
            <input type="text"
                   ng-if="shouldDisplayInboundFields(item)"
                   name="inboundQuantity-{{$index}}"
                   custom-validity
                   custom-pattern="number"
                   class="form-control"
                   ng-model="item.inboundQuantity"
                   ng-disabled="readOnly"
                   maxlength="5"
                   placeholder="0"/>
          </td>
          <td ng-if="shouldDisplayQuantityField('ullage')">
            <input type="text"
                   ng-if="shouldDisplayInboundFields(item)"
                   custom-validity
                   custom-pattern="number"
                   name="ullageQuantity-{{$index}}"
                   class="form-control"
                   ng-model="item.ullageQuantity"
                   ng-disabled="readOnly"
                   maxlength="5"
                   placeholder="0"/>
          </td>
          <td ng-if="shouldDisplayQuantityField('ullage')">
            <ui-select ng-model="item.ullageReason" theme="bootstrap" ng-if="shouldDisplayInboundFields(item)">
              <ui-select-match placeholder="Select an Ullage Reason">{{ $select.selected.companyReasonCodeName }}
              </ui-select-match>
              <ui-select-choices
                repeat="ullageReason in ullageReasonCodes | filter: {companyReasonCodeName:$select.search} | orderBy:'companyReasonCodeName'">
                <div
                  ng-bind-html="ullageReason.companyReasonCodeName | highlight: $select.search"></div>
              </ui-select-choices>
            </ui-select>
          </td>
          <td ng-if="shouldDisplayQuantityField('template')">
            <input type="text" class="form-control" ng-model="item.menuQuantity" placeholder="0"
                   disabled/>
          </td>
          <td ng-if="shouldDisplayQuantityField('packed')">
            <input type="text"
                   custom-validity
                   custom-pattern="number"
                   required="true"
                   class="form-control"
                   ng-model="item.quantity"
                   ng-disabled="readOnly"
                   maxlength="5"
                   placeholder="0"/>
          </td>
          <td ng-if="shouldDisplayQuantityField('dispatch')">
            <input type="text" class="form-control" placeholder="0"
                   disabled ng-value="calculateTotalDispatchedQty(item)"/>
          </td>
          <td>
            <button type="button" ng-if="!item.menuQuantity" class="btn btn-sm btn-danger"
                    ng-click="showDeleteWarning(item)" ng-hide="readOnly">
              <i class="fa fa-close"></i>
            </button>
          </td>
        </tr>

        <tr ng-repeat="item in emptyMenuItems track by $index" ng-hide="readOnly">
          <td>
            <ui-select ng-model="item.masterItem" theme="bootstrap" on-select="warnForDuplicateSelection(item)">
              <ui-select-match placeholder="Select item from list">{{$select.selected.itemCode }} - {{
                $select.selected.itemName }}
              </ui-select-match>
              <ui-select-choices
                repeat="masterItem in filteredMasterItemList | filter: {itemName:$select.search} | orderBy:'itemName'">
                <div ng-bind-html="masterItem.itemName | highlight: $select.search"></div>
              </ui-select-choices>
            </ui-select>
          </td>
          <td ng-if="shouldDisplayQuantityField('inbound')">
            <input type="text" custom-validity custom-pattern="number" class="form-control" ng-model="item.inboundQuantity" placeholder="0"
                   ng-if="shouldDisplayInboundFields(item)" maxlength="5"/>
          </td>
          <td ng-if="shouldDisplayQuantityField('ullage')">
            <input type="text" custom-validity custom-pattern="number" class="form-control" ng-model="item.ullageQuantity" placeholder="0"
                   ng-if="shouldDisplayInboundFields(item)" maxlength="5"/>
          </td>
          <td ng-if="shouldDisplayQuantityField('ullage')">
            <ui-select ng-model="item.ullageReason" theme="bootstrap" ng-if="shouldDisplayInboundFields(item)">
              <ui-select-match placeholder="Select an Ullage Reason">{{ $select.selected.companyReasonCodeName }}
              </ui-select-match>
              <ui-select-choices
                repeat="ullageReason in ullageReasonCodes | filter: {companyReasonCodeName:$select.search} | orderBy:'companyReasonCodeName'">
                <div
                  ng-bind-html="ullageReason.companyReasonCodeName | highlight: $select.search"></div>
              </ui-select-choices>
            </ui-select>
          </td>
          <td ng-if="shouldDisplayQuantityField('template')">
            <input type="text" class="form-control" ng-model="item.menuQuantity" disabled/>
          </td>
          <td ng-if="shouldDisplayQuantityField('packed')">
            <input type="text" custom-validity custom-pattern="number" class="form-control" ng-model="item.quantity"
                   maxlength="5" required="true" placeholder="0">
          </td>
          <td ng-if="shouldDisplayQuantityField('dispatch')">
            <input type="text" class="form-control" placeholder="0"
                   disabled ng-value="calculateTotalDispatchedQty(item)" required="true"/>
          </td>
          <td ng-init="item.index = $index">
            <button type="button" class="btn btn-sm btn-danger" ng-click="showDeleteWarning(item)">
              <i class="fa fa-close"></i>
            </button>
          </td>
        </tr>

        </tbody>
      </table>
      <br>

      <div class="row" ng-hide="readOnly">
        <div class="col-xs-7 col-md-9"></div>
        <div class="col-xs-5 col-md-3 text-right">
          <div class="input-group pull-right">
            <input type="number" min="1" max="100" class="form-control" ng-model="addItemsNumber" placeholder="1"/>
                  <span class="input-group-btn">
                    <button class="btn btn-primary" type="button" ng-click="addItems()"><i class="fa fa-plus"></i> Add
                      Items
                    </button>
                  </span>
          </div>
        </div>
      </div>
    </div>

    <div class="well" ng-show="isActionState('redispatch')">
      <h3>Offload List</h3>
      <table class="table table-striped pick-list" ng-if="isActionState('redispatch')">
        <thead>
        <tr>
          <th>Retail Item Details</th>
          <th width="10%">Inbound Quantity</th>
          <th width="10%">Ullage Quantity</th>
          <th width="30%">Ullage Reason</th>
          <th width="5%"></th>
        </tr>
        </thead>

        <tbody>
        <tr ng-repeat="item in offloadMenuItems | filter:{itemDescription: filterItemDetails} | orderBy:'itemName'">
          <td>
            <input type="text" class="form-control" ng-model="item.itemDescription"
                   disabled/>
          </td>
          <td>
            <input type="text"
                   name="inboundQuantity-{{$index}}"
                   custom-validity
                   custom-pattern="number"
                   class="form-control"
                   ng-model="item.inboundQuantity"
                   ng-disabled="readOnly"
                   maxlength="5"
                   placeholder="0"
                   required="true"/>
          </td>
          <td>
            <input type="text"
                   name="ullageQuantity-{{$index}}"
                   custom-validity
                   custom-pattern="number"
                   class="form-control"
                   ng-model="item.ullageQuantity"
                   ng-disabled="readOnly"
                   maxlength="5"
                   placeholder="0"/>
          </td>
          <td>
            <ui-select ng-model="item.ullageReason" theme="bootstrap">
              <ui-select-match placeholder="Select an Ullage Reason">{{ $select.selected.companyReasonCodeName }}
              </ui-select-match>
              <ui-select-choices
                repeat="ullageReason in ullageReasonCodes | filter: {companyReasonCodeName:$select.search} | orderBy:'companyReasonCodeName'">
                <div
                  ng-bind-html="ullageReason.companyReasonCodeName | highlight: $select.search"></div>
              </ui-select-choices>
            </ui-select>
          </td>
          <td>
            <button type="button" ng-if="!item.menuQuantity" class="btn btn-sm btn-danger"
                    ng-click="showDeleteWarning(item)" ng-hide="readOnly">
              <i class="fa fa-close"></i>
            </button>
          </td>
        </tr>

        <tr ng-repeat="item in emptyOffloadMenuItems track by $index" ng-hide="readOnly">
          <td>
            <ui-select ng-model="item.masterItem" theme="bootstrap" on-select="warnForDuplicateSelection(item)">
              <ui-select-match placeholder="Select item from list">{{$select.selected.itemCode }} - {{
                $select.selected.itemName }}
              </ui-select-match>
              <ui-select-choices
                repeat="masterItem in filteredMasterItemList | filter: {itemName:$select.search} | orderBy:'itemName'">
                <div ng-bind-html="masterItem.itemName | highlight: $select.search"></div>
              </ui-select-choices>
            </ui-select>
          </td>
          <td>
            <input custom-validity custom-pattern="number" type="text" class="form-control" ng-model="item.inboundQuantity"
                   maxlength="5" placeholder="0" required="true" />
          </td>
          <td>
            <input custom-validity custom-pattern="number" type="text" class="form-control" ng-model="item.ullageQuantity"
                   maxlength="5" placeholder="0"/>
          </td>
          <td>
            <ui-select ng-model="item.ullageReason" theme="bootstrap">
              <ui-select-match placeholder="Select an Ullage Reason">{{ $select.selected.companyReasonCodeName }}
              </ui-select-match>
              <ui-select-choices
                repeat="ullageReason in ullageReasonCodes | filter: {companyReasonCodeName:$select.search} | orderBy:'companyReasonCodeName'">
                <div
                  ng-bind-html="ullageReason.companyReasonCodeName | highlight: $select.search"></div>
              </ui-select-choices>
            </ui-select>
          </td>
          <td ng-init="item.index = $index">
            <button type="button" class="btn btn-sm btn-danger" ng-click="showDeleteWarning(item)">
              <i class="fa fa-close"></i>
            </button>
          </td>
        </tr>

        </tbody>
      </table>

      <div class="row" ng-hide="readOnly">
        <div class="col-xs-7 col-md-9"></div>
        <div class="col-xs-5 col-md-3 text-right">
          <div class="input-group pull-right">
            <input type="number" min="1" max="100" class="form-control" placeholder="1" ng-model="addOffloadItemsQty"/>
                  <span class="input-group-btn">
                    <button class="btn btn-primary" type="button" ng-click="addOffloadItems()"><i class="fa fa-plus"></i> Add Items
                    </button>
                  </span>
          </div>
        </div>
      </div>
      <br>

    </div>

    <footer ng-hide="readOnly" class="text-right">
      <button type="button" ng-click="goToPreviousStep()" class="btn btn-default">
        <i class="fa fa-arrow-left"></i>
        <span class="btn-label">Prev</span>
      </button>
      <button type="submit" class="btn btn-success" ng-show="canProceed()">
        <span class="btn-label">Next</span>
        <i class="fa fa-arrow-right"></i>
      </button>
    </footer>

  </form>

</div>

<delete-record-dialog></delete-record-dialog>
