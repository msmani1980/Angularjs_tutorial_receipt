<div class="container-fluid">

  <!--payment report panel-->
  <div class="modal right fade" id="paymentReportModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <div class="panel" ng-repeat="report in paymentReport">
            <h4>{{report.reportTitle}} Report</h4>
            <div class="panel-body">
              <p>Flight Date: {{report.scheduleDate}}</p>

              <div ng-repeat="sector in report.sectors">
                <p>Flight Number: {{sector.flightNumber}} (Pax {{sector.pax}})</p>
                <p>Sector: {{sector.departureStation}} - {{sector.arrivalStation}}</p>
              </div>

              <p>Store #: {{storeInstance.storeDetails.storeNumber}}</p>
              <p>Aircraft Registration: {{report.carrierNumber}}</p>

              <p>Cash Bag #: {{report.flightDate}}</p>

              <table class="table table-bordered col-xs-12">
                <tr class="active">
                  <td>Crew ID</td>
                  <td>Last Name</td>
                </tr>
                <tr ng-repeat="crewMember in report.crew">
                  <td>{{crewMember.CrewId}}</td>
                  <td>{{crewMember.LastName}}</td>
                </tr>
              </table>
              <table class="table col-xs-12">
                <tr>
                  <td>Expected Cash Total</td>
                  <td>{{report.cashTotal}}</td>
                </tr>
                <tr>
                  <td>Card Total</td>
                  <td>{{report.creditTotal}}</td>
                </tr>
                <tr>
                  <td>Voucher Total</td>
                  <td>{{report.voucherTotal}}</td>
                </tr>
                <tr>
                  <td>Complimentary Total</td>
                  <td>{{report.compTotal}}</td>
                </tr>
                <tr>
                  <td>Expected Total</td>
                  <td>{{report.total}}</td>
                </tr>
              </table>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!--payment report panel-->

  <div class="modal fade" id="t6Modal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <h4>{{ modalMainTitle }}: {{modalTotal}}</h4>
          <br>
          <table class="table table-bordered">
            <tr class="active">
              <td>{{ modalTableHeader }}</td>
              <td>Quantity</td>
              <td>Total</td>
            </tr>
            <tr ng-repeat="stockItem in stockTotals.stockItems | filter:{itemTypeName:modalItemTypeName}">
              <td>{{stockItem.itemName}}</td>
              <td>{{stockItem.eposQuantity}}</td>
              <td>{{stockItem.eposTotal}}</td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <div class="main">
    <header>
      <div class="row item-list-row">
        <div class="col-xs-8">
          <h3 class="view-name">Discrepancy Detail</h3>
        </div>
        <div class="col-xs-4 text-right">
          <button class="btn btn-warning" ng-click="showPaymentReportPanel()">
            {{actionOnPaymentReport}} Payment Reports
          </button>
        </div>
      </div>
      <br/>
      <error-dialog form-object="reconciliationForm" error-response="errorResponse" display="displayError"></error-dialog>

      <div class="panel panel-default col-xs-12">
        <div class="col-xs-4 text-left pull-left">
          <h4>
            <strong>Store # {{storeInstance.storeDetails.storeNumber}}</strong><br>
            <small>{{storeInstance.scheduleDate}}</small>
          </h4>
        </div>
        <div class="col-xs-4 text-center">
          <h4><br>
            <small>Store Instance: {{storeInstance.id}}</small>
          </h4>
        </div>

        <div class="col-xs-4 text-right">
          <h4><br>
            <small>Warehouse: {{storeInstance.warehouseDetails.name}}</small>
          </h4>
        </div>
      </div>
      <br/>
    </header>

    <div class="accordion-wrapper">

      <accordion class="store-instance-review-accordion" ng-class="{'accordion-footer':isEndInstance()}">
        <accordion-group ng-init="status.items.open=true" is-open="status.items.open">
          <accordion-heading class="accordion-heading">
            <i ng-class="{'fa-chevron-down': status.items.open, 'fa-chevron-right': !status.items.open}"
               class="fa"></i>
            Discrepancy
          </accordion-heading>
          <div clas="row">
            <div class="col-xs-4">
              <table class="table table-bordered">
                <tr>
                  <td colspan="2" class="active">LMP Station Stock [{{companyBaseCurrency.currencyCode}}]</td>
                </tr>
                <tr>
                  <td>Gross Value of LMP Stock</td>
                  <td>{{stockTotals.totalRetail.totalLMP}}</td>
                </tr>
                <tr>
                  <td>Virtual Items</td>
                  <td>+{{stockTotals.totalVirtual.totalEPOS}}</td>
                </tr>
                <tr>
                  <td>Voucher Items</td>
                  <td>+{{stockTotals.totalVoucher.totalEPOS}}</td>
                </tr>
                <tr>
                  <td>Promotion Discounts</td>
                  <td>-{{stockTotals.totalPromotion.totalLMP}}</td>
                </tr>
                <tr class="active">
                  <td>Net Value of LMP Stock</td>
                  <td>{{stockTotals.totalNet.netLMP}}</td>
                </tr>
              </table>
            </div>
            <div class="col-xs-4">
              <table class="table table-bordered">
                <tr class="active">
                  <td colspan="2">ePOS Sales [{{companyBaseCurrency.currencyCode}}]</td>
                </tr>
                <tr>
                  <td>Gross Value of ePOS Sales</td>
                  <td>{{stockTotals.totalRetail.totalEPOS}}</td>
                </tr>
                <tr>
                  <td><a ng-click="showModal('Virtual')">Virtual Items</a></td>
                  <td>+{{stockTotals.totalVirtual.totalEPOS}}</td>
                </tr>
                <tr>
                  <td><a ng-click="showModal('Voucher')">Voucher Items</a></td>
                  <td>+{{stockTotals.totalVoucher.totalEPOS}}</td>
                </tr>
                <tr>
                  <td><a ng-click="showModal('Promotion')">Promotion Discount</a></td>
                  <td>-{{stockTotals.totalPromotion.totalEPOS}}</td>
                </tr>
                <tr class="active">
                  <td>Net Value of ePOS Sales</td>
                  <td>{{stockTotals.totalNet.netEPOS}}</td>
                </tr>
              </table>
            </div>
            <div class="col-xs-4">
              <table class="table table-bordered">
                <tr>
                  <td class="active" colspan="2">Total Revenue [{{companyBaseCurrency.currencyCode}}]</td>
                </tr>
                <tr>
                  <td>@ Cash Handler Exchange Rate</td>
                  <td>{{totalRevenue.cashHandler}}</td>
                </tr>
                <tr>
                  <td>@ ePOS Exchange Rate</td>
                  <td>{{totalRevenue.epos}}</td>
                </tr>
              </table>
            </div>
          </div>
          <div class="col-xs-12">
            <table class="table table-bordered">
              <tr class="info">
                <th>Discrepancy</th>
                <th>Value</th>
                <th>%</th>
              </tr>
              <tr>
                <td>Net LMP vs Net ePOS</td>
                <td>{{discrepancy.net.value}}</td>
                <td>{{discrepancy.net.percentage}}</td>
              </tr>
              <tr>
                <td>Total Revenue @ Cash Handler Exchange Rate vs Net ePOS</td>
                <td>{{discrepancy.revenue.value}}</td>
                <td>{{discrepancy.revenue.percentage}}</td>
              </tr>
              <tr>
                <td>Foreign Exchange</td>
                <td>{{discrepancy.exchange.value}}</td>
                <td>{{discrepancy.exchange.percentage}}</td>
              </tr>
              <tr class="active">
                <th>Total</th>
                <th>{{discrepancy.total.value}}</th>
                <th>{{discrepancy.total.percentage}}</th>
              </tr>
            </table>
          </div>
        </accordion-group>
      </accordion>

      <form name="reconciliationForm" ng-submit="submitForm()">

        <div class="accordion-wrapper">
          <accordion class="store-instance-review-accordion" ng-class="{'accordion-footer':isEndInstance()}">
            <accordion-group ng-init="status.items.open=false" is-open="status.items.open">
              <accordion-heading class="accordion-heading">
                <i ng-class="{'fa-chevron-down': status.items.open, 'fa-chevron-right': !status.items.open}"
                   class="fa"></i>
                Stock Discrepancy
              </accordion-heading>

              <div class="row">
                <div class="col-xs-8">
                  <label>Filter by Item Name</label>
                  <input type="text" class="form-control" ng-model="filterItemDetails.itemName" placeholder="Type an item name or category"/>
                </div>
                <div class="col-xs-4">
                  <label>Show Only Discrepancies</label>
                  <br>
                  <input bs-switch ng-model="showLMPDiscrepancies" type="checkbox" switch-size="small" switch-on-color="info" switch-on-text="Yes" switch-off-text="No">
                </div>
              </div>
              <br>
              <table class="table table-bordered">
                <tr class="active">
                  <th ng-click="updateOrderBy('itemName', true)">
                    <span class="fa fa-sort-asc active" ng-show="getArrowType('itemName', true) === 'ascending'"></span>
                    <span class="fa fa-sort-desc active" ng-show="getArrowType('itemName', true) === 'descending'"></span>
                    <span class="fa fa-sort active text-muted-light" ng-show="getArrowType('itemName', true) === 'none'"></span>
                    Retail Item
                  </th>
                  <th ng-click="updateOrderBy('dispatchedCount', true)">
                    <span class="fa fa-sort-asc active" ng-show="getArrowType('dispatchedCount', true) === 'ascending'"></span>
                    <span class="fa fa-sort-desc active" ng-show="getArrowType('dispatchedCount', true) === 'descending'"></span>
                    <span class="fa fa-sort active text-muted-light" ng-show="getArrowType('dispatchedCount', true) === 'none'"></span>
                    Dispatched<br/>Count
                  </th>
                  <th ng-click="updateOrderBy('replenishCount', true)">
                    <span class="fa fa-sort-asc active" ng-show="getArrowType('dispatchedCount', true) === 'ascending'"></span>
                    <span class="fa fa-sort-desc active" ng-show="getArrowType('dispatchedCount', true) === 'descending'"></span>
                    <span class="fa fa-sort active text-muted-light" ng-show="getArrowType('dispatchedCount', true) === 'none'"></span>
                    Replenish<br/>Count
                  </th>
                  <th ng-click="updateOrderBy('inboundOffloadCount', true)">
                    <span class="fa fa-sort-asc active" ng-show="getArrowType('inboundOffloadCount', true) === 'ascending'"></span>
                    <span class="fa fa-sort-desc active" ng-show="getArrowType('inboundOffloadCount', true) === 'descending'"></span>
                    <span class="fa fa-sort active text-muted-light" ng-show="getArrowType('inboundOffloadCount', true) === 'none'"></span>
                    Inbounded<br/>or Offload Count
                  </th>
                  <th ng-click="updateOrderBy('ePOSSales', true)">
                    <span class="fa fa-sort-asc active" ng-show="getArrowType('ePOSSales', true) === 'ascending'"></span>
                    <span class="fa fa-sort-desc active" ng-show="getArrowType('ePOSSales', true) === 'descending'"></span>
                    <span class="fa fa-sort active text-muted-light" ng-show="getArrowType('ePOSSales', true) === 'none'"></span>
                    ePOS Sales
                  </th>
                  <th ng-click="updateOrderBy('varianceQuantity', true)">
                    <span class="fa fa-sort-asc active" ng-show="getArrowType('varianceQuantity', true) === 'ascending'"></span>
                    <span class="fa fa-sort-desc active" ng-show="getArrowType('varianceQuantity', true) === 'descending'"></span>
                    <span class="fa fa-sort active text-muted-light" ng-show="getArrowType('varianceQuantity', true) === 'none'"></span>
                    Variance Quantity
                  </th>
                  <th ng-click="updateOrderBy('retailValue', true)">
                    <span class="fa fa-sort-asc active" ng-show="getArrowType('retailValue', true) === 'ascending'"></span>
                    <span class="fa fa-sort-desc active" ng-show="getArrowType('retailValue', true) === 'descending'"></span>
                    <span class="fa fa-sort active text-muted-light" ng-show="getArrowType('retailValue', true) === 'none'"></span>
                    Retail Item<br/>Price [{{companyBaseCurrency.currencyCode}}]
                  </th>
                  <th ng-click="updateOrderBy('varianceValue', true)">
                    <span class="fa fa-sort-asc active" ng-show="getArrowType('varianceValue', true) === 'ascending'"></span>
                    <span class="fa fa-sort-desc active" ng-show="getArrowType('varianceValue', true) === 'descending'"></span>
                    <span class="fa fa-sort active text-muted-light" ng-show="getArrowType('varianceValue', true) === 'none'"></span>
                    Variance<br/>Value [{{companyBaseCurrency.currencyCode}}]
                  </th>
                  <th></th>
                </tr>
                <tr ng-repeat="item in filteredLMPStock = (stockItemList | filter:filterItemDetails | orderBy: LMPSortTitle)"
                    ng-show="showLMPDiscrepancies ? item.isDiscrepancy : true">
                  <td>
                    <span>{{ item.itemName }}</span>
                  </td>
                  <td>
                    <input ng-show="showEditViewForItem(item, true)" type="text" class="form-control" ng-model="item.revision.dispatchedCount">
                    <span ng-hide="showEditViewForItem(item, true)">{{ item.dispatchedCount }}</span>
                  </td>
                  <td>
                    <input ng-show="showEditViewForItem(item, true)" type="text" class="form-control" ng-model="item.revision.replenishCount">
                    <span ng-hide="showEditViewForItem(item, true)">{{ item.replenishCount }}</span>
                  </td>
                  <td>
                    <input ng-show="showEditViewForItem(item, true)" type="text" class="form-control" ng-model="item.revision.inboundOffloadCount">
                    <span ng-hide="showEditViewForItem(item, true)">{{ item.inboundOffloadCount }}</span>
                  </td>
                  <td>
                    <span>{{ item.ePOSSales }}</span>
                  </td>
                  <td>
                    <span>{{ item.varianceQuantity }}</span>
                  </td>
                  <td>
                    <span>{{ item.retailValue }}</span>
                  </td>
                  <td>
                    <span>{{ item.varianceValue }}</span>
                  </td>
                  <td>
                    <a class="btn btn-primary btn-xs btn-block" tabindex="0" ng-click="editItem(item)" ng-hide="showEditViewForItem(item, true)"><span
                      class="fa fa-pencil"></span></a>
                    <a class="btn btn-success btn-xs btn-block" tabindex="0" ng-click="saveItem(item)" ng-show="item.isEditing"><span class="fa fa-check"></span></a>
                    <a class="btn btn-default btn-xs btn-block" tabindex="0" ng-click="cancelEditItem(item)" ng-show="item.isEditing"><span class="fa fa-times"></span></a>
                    <a class="btn btn-default btn-xs btn-block" tabindex="0" ng-click="revertItem(item)" ng-show="editLMPStockTable"><span class="fa fa-undo"></span></a>
                  </td>
                </tr>
                <tr ng-show="filteredLMPStock.length === 0">
                  <td colspan="8" class="text-center"><span class="fa fa-exclamation-circle text-danger"></span> We're sorry, there are no items that match the given criteria
                  </td>
                </tr>
              </table>

              <div class="row">
                <div class="col-xs-12 text-right">
                  <button ng-hide="editLMPStockTable" class="btn btn-primary" ng-click="initEditTable(true)"><span class="fa fa-pencil active"></span> Edit Table</button>
                  <button ng-show="editLMPStockTable" class="btn btn-success" ng-click="saveTable(true)"><span class="fa fa-check active"></span> Save All</button>
                  <button ng-show="editLMPStockTable" class="btn btn-default" ng-click="cancelEditingTable(true)">Cancel</button>
                </div>
              </div>
            </accordion-group>
          </accordion>

          <accordion class="store-instance-review-accordion">
            <accordion-group ng-init="status.seals.open=false" is-open="status.seals.open">
              <accordion-heading class="accordion-heading">
                <i ng-class="{'fa-chevron-down': status.seals.open, 'fa-chevron-right': !status.seals.open}"
                   class="fa"></i>
                Cash Discrepancy
              </accordion-heading>
              <div class="row">
                <div class="col-xs-8">
                  <label>Filter by Cash Bag</label>
                  <ui-select multiple ng-model="cashBagFilter.filter" theme="bootstrap">
                    <ui-select-match placeholder="Select Cash Bags...">{{ $item.cashBag }}</ui-select-match>
                    <ui-select-choices repeat="cashBag in cashBags | filter: $select.search">
                      {{ cashBag.cashBag }}
                    </ui-select-choices>
                  </ui-select>
                </div>
                <div class="col-xs-4">
                  <label>Show Only Discrepancies</label>
                  <br>
                  <input bs-switch ng-model="showCashBagDiscrepancies" type="checkbox" switch-size="small" switch-on-color="info" switch-on-text="Yes" switch-off-text="No">
                  </select>
                </div>
              </div>
              <br>

              <table class="table table-striped table-bordered">
                <tr>
                  <th ng-click="updateOrderBy('cashBag', false)">
                    <span class="fa fa-sort-asc active" ng-show="getArrowType('cashBag', false) === 'ascending'"></span>
                    <span class="fa fa-sort-desc active" ng-show="getArrowType('cashBag', false) === 'descending'"></span>
                    <span class="fa fa-sort active text-muted-light" ng-show="getArrowType('cashBag', false) === 'none'"></span>
                    Cash Bag Number
                  </th>
                  <th ng-click="updateOrderBy('currency', false)">
                    <span class="fa fa-sort-asc active" ng-show="getArrowType('currency', false) === 'ascending'"></span>
                    <span class="fa fa-sort-desc active" ng-show="getArrowType('currency', false) === 'descending'"></span>
                    <span class="fa fa-sort active text-muted-light" ng-show="getArrowType('currency', false) === 'none'"></span>
                    Currency
                  </th>
                  <th ng-click="updateOrderBy('exchangeAmount', false)">
                    <span class="fa fa-sort-asc active" ng-show="getArrowType('exchangeAmount', false) === 'ascending'"></span>
                    <span class="fa fa-sort-desc active" ng-show="getArrowType('exchangeAmount', false) === 'descending'"></span>
                    <span class="fa fa-sort active text-muted-light" ng-show="getArrowType('exchangeAmount', false) === 'none'"></span>
                    ePOS Calculated Amount
                  </th>
                  <th ng-click="updateOrderBy('crewAmount', false)">
                    <span class="fa fa-sort-asc active" ng-show="getArrowType('crewAmount', false) === 'ascending'"></span>
                    <span class="fa fa-sort-desc active" ng-show="getArrowType('crewAmount', false) === 'descending'"></span>
                    <span class="fa fa-sort active text-muted-light" ng-show="getArrowType('crewAmount', false) === 'none'"></span>
                    ePOS Crew Amount
                  </th>
                  <th ng-click="updateOrderBy('paperAmount', false)">
                    <span class="fa fa-sort-asc active" ng-show="getArrowType('paperAmount', false) === 'ascending'"></span>
                    <span class="fa fa-sort-desc active" ng-show="getArrowType('paperAmount', false) === 'descending'"></span>
                    <span class="fa fa-sort active text-muted-light" ng-show="getArrowType('paperAmount', false) === 'none'"></span>
                    Cash Handler Paper Amount
                  </th>
                  <th ng-click="updateOrderBy('coinAmount', false)">
                    <span class="fa fa-sort-asc active" ng-show="getArrowType('coinAmount', false) === 'ascending'"></span>
                    <span class="fa fa-sort-desc active" ng-show="getArrowType('coinAmount', false) === 'descending'"></span>
                    <span class="fa fa-sort active text-muted-light" ng-show="getArrowType('coinAmount', false) === 'none'"></span>
                    Cash Handler Coin Amount
                  </th>
                  <th ng-click="updateOrderBy('varianceValue', false)">
                    <span class="fa fa-sort-asc active" ng-show="getArrowType('varianceValue', false) === 'ascending'"></span>
                    <span class="fa fa-sort-desc active" ng-show="getArrowType('varianceValue', false) === 'descending'"></span>
                    <span class="fa fa-sort active text-muted-light" ng-show="getArrowType('varianceValue', false) === 'none'"></span>
                    Variance Value
                  </th>
                  <th ng-click="updateOrderBy('bankExchangeRate', false)">
                    <span class="fa fa-sort-asc active" ng-show="getArrowType('bankExchangeRate', false) === 'ascending'"></span>
                    <span class="fa fa-sort-desc active" ng-show="getArrowType('bankExchangeRate', false) === 'descending'"></span>
                    <span class="fa fa-sort active text-muted-light" ng-show="getArrowType('bankExchangeRate', false) === 'none'"></span>
                    Bank Exchange Rate
                    <!-- Paper & Coin Exchange Rate, as per Retail Company-->
                  </th>
                  <th ng-click="updateOrderBy('totalBank', false)">
                    <span class="fa fa-sort-asc active" ng-show="getArrowType('totalBank', false) === 'ascending'"></span>
                    <span class="fa fa-sort-desc active" ng-show="getArrowType('totalBank', false) === 'descending'"></span>
                    <span class="fa fa-sort active text-muted-light" ng-show="getArrowType('totalBank', false) === 'none'"></span>
                    Total Banked [{{companyBaseCurrency.currencyCode}}]
                  </th>
                  <td></td>
                </tr>
                <tr ng-repeat="item in cashBags | orderBy: cashBagSortTitle" ng-show="showCashBagDiscrepancies ? item.isDiscrepancy : true">
                  <td>
                    <span>{{ item.cashBagNumber }}</span>
                  </td>
                  <td>
                    <span>{{ item.currency }}</span>
                  </td>
                  <td>
                    <span>{{ item.eposCalculatedAmount }}</span>
                  </td>
                  <td>
                    <span>{{ item.crewAmount }}</span>
                  </td>
                  <td>
                    <input ng-show="showEditViewForItem(item, false)" type="text" class="form-control" ng-model="item.revision.paperAmount">
                    <span ng-hide="showEditViewForItem(item, false)">{{ item.paperAmount }}</span>
                  </td>
                  <td>
                    <input ng-show="showEditViewForItem(item, false)" type="text" class="form-control" ng-model="item.revision.coinAmount">
                    <span ng-hide="showEditViewForItem(item, false)">{{ item.coinAmount }}</span>
                  </td>
                  <td>
                    <span>{{ item.varianceValue }}</span>
                  </td>
                  <td>
                    <span>{{ item.bankExchangeRate }}</span>
                  </td>
                  <td>
                    <span>{{ item.totalBank }}</span>
                  </td>
                  <td>
                    <a class="btn btn-info btn-xs btn-block" tabindex="0"><span class="fa fa-file-text"></span></a>
                    <a class="btn btn-primary btn-xs btn-block" tabindex="0" ng-click="editItem(item)" ng-hide="showEditViewForItem(item, false)"><span
                      class="fa fa-pencil"></span></a>
                    <a class="btn btn-success btn-xs btn-block" tabindex="0" ng-click="saveItem(item)" ng-show="item.isEditing"><span class="fa fa-check"></span></a>
                    <a class="btn btn-default btn-xs btn-block" tabindex="0" ng-click="cancelEditItem(item)" ng-show="item.isEditing"><span class="fa fa-times"></span></a>
                    <a class="btn btn-default btn-xs btn-block" tabindex="0" ng-click="revertItem(item)" ng-show="editCashBagTable"><span class="fa fa-undo"></span></a>
                  </td>
                </tr>
              </table>

              <div class="row">
                <div class="col-xs-12 text-right">
                  <button ng-hide="editCashBagTable" class="btn btn-primary" ng-click="initEditTable(false)"><span class="fa fa-pencil active"></span> Edit Table</button>
                  <button ng-show="editCashBagTable" class="btn btn-success" ng-click="saveTable(false)"><span class="fa fa-check active"></span> Save All</button>
                  <button ng-show="editCashBagTable" class="btn btn-default" ng-click="cancelEditingTable(false)">Cancel</button>
                </div>
              </div>
            </accordion-group>
          </accordion>
        </div>
      </form>

    </div>
  </div>
</div>
